
/**
 * Keetjs v4.0.0 Alpha release: https://github.com/keetjs/keet
 * Minimalist view layer for the web
 *
 * <<<<<<<<<<<<<<<<<<<<<<<<<<<<<< Keetjs >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
 *
 * Copyright 2018, Shahrul Nizam Selamat
 * Released under the MIT License.
 */
var keet=function(){"use strict";function t(t,e){"function"==typeof e&&e(t)}function e(t,i){for(var n=void 0;t;)n=t,t=t.nextSibling,n&&n.nodeType===B?n.isEqualNode(i)?(n.remove(),i=i.nextSibling):e(n.firstChild,i):n.isEqualNode(i)&&(n.remove(),i=i.nextSibling)}function i(t,i,n,o){var r=void 0,l=void 0,a=void 0,d=document.createDocumentFragment();if("initial"!==n||q.hasOwnProperty(i)){if("conditional-set"===n){if(t.nextSibling.isEqualNode(q[i].frag.firstChild))return;a=q[i].frag.cloneNode(!0),o.call(this,a.firstChild),t.parentNode.insertBefore(a,t.nextSibling)}}else for(l=t;l;)r=l,l=l.nextSibling,r.nodeType!==B&&r.nodeValue.match(w)?(l=null,q[i]=q[i]||{},e(this.__pristineFragment__.firstChild,d.firstChild),q[i].frag=d):r.nodeType!==U&&d.appendChild(r)}function n(t){for(;t;)J=t,t=t.nextSibling,J.nodeType===L?n.call(this,J.firstChild):J.nodeType===R&&J.nodeValue.match($)&&(H=J.nodeValue.trim().match(W),z=z.concat(H),K=K.concat(J))}function o(e){z=[],K=[],n.call(this,this.base.firstChild);for(var o=z.length;o>0;)o--,t(z[o],e.bind(this)),i.call(this,K[o],z[o],"initial")}function r(t){for(;t;)tt=t,t=t.nextSibling,tt.nodeType===Z?r.call(this,tt.firstChild):tt.nodeType===G&&tt.nodeValue.match(Q)&&(Y=tt.nodeValue.trim().match(X),Y=Y&&Y[0],this[Y]&&i.call(this,tt,Y,"conditional-set",l))}function l(t){r.call(this,t)}function a(t){if(t.match(/([^?]*)\?([^:]*):([^;]*)|(\s*=\s*)[^;]*/g)){var e=t.split("?"),i=e[0],n=e[1].split(":")[0],o=e[1].split(":")[1];return!!this&&(this[i]?{value:ht(n),state:i}:{value:ht(o),state:i})}return!1}function d(t,e){xt=yt(t,e),St=kt.createContextualFragment(xt),St.firstChild.setAttribute("kdata-id",e["kdata-id"])}function s(t,e,i){var n=t.getElementById(e);n?n.childNodes[1].remove():i||Object.keys(q).map(function(t){return s(q[t].frag,e,!0)})}function c(t,e,i){var n=void 0,o=void 0,r=void 0,l=void 0,a=void 0,c=void 0,h=void 0,u=void 0,f=void 0,p=void 0,v=void 0,g=void 0,m=void 0,b=void 0,y=void 0,C=void 0;if(Nt[e]=Nt[e]||{},m=this[e]&&this[e].enableFiltering?"listFilter":"list",Nt[e][m]||(Nt[e][m]=t.nextSibling.cloneNode(!0)),p=Nt[e][m],Nt[e].str||(Nt[e].str=t.nextSibling.cloneNode(!0).outerHTML,t.nextSibling.remove(),s(this.__pristineFragment__,t.parentNode.id)),v=Nt[e].str,void 0!==this[e]&&this[e].hasOwnProperty(m))if(l=t.parentNode,kt&&!l.hasAttribute("data-ignore")&&l.setAttribute("data-ignore",""),n=this[e][m],g=Nt[e].oldModel||[],kt){a=Ct(n,g),c=Ct(g,n);var k=function(){for(var t=arguments.length,i=Array(t),r=0;r<t;r++)i[r]=arguments[r];if(h=i.pop(),u=g.length===n.length,u&&2!==h.childNodes.length)for(o=0;o<a.length;)f=h.querySelector(a[o]["kdata-id"]===c[o]["kdata-id"]?'[kdata-id="'+a[o]["kdata-id"]+'"]':'[kdata-id="'+c[o]["kdata-id"]+'"]'),f&&(d(v,a[o]),h.replaceChild(St,f)),o++;else if(a.length>0&&0===c.length)for(o=0;o<a.length;)d(v,a[o]),a[o]["kdata-id"]===n[n.length-1]["kdata-id"]?y=h.lastChild:(b=n.map(function(t){return t["kdata-id"]}).indexOf(a[o]["kdata-id"]),y=h.childNodes[b].nextSibling),h.insertBefore(St,y),o++;else if(0===a.length&&c.length>0)for(o=0;o<c.length;)f=h.querySelector('[kdata-id="'+c[o]["kdata-id"]+'"]'),f&&h.removeChild(f),o++;else if(a.length>0&&c.length>0){for(o=0;o<c.length;)if(f=h.querySelector('[kdata-id="'+c[o]["kdata-id"]+'"]'),f&&h.removeChild(f),o++,o===c.length)for(C=0;C<a.length;)d(v,a[C]),h.insertBefore(St,h.lastChild),C++}else for(o=0;o<n.length;)d(v,n[o]),h.insertBefore(St,h.lastChild),o++;Nt[e].oldModel=JSON.parse(JSON.stringify(n))};l.hasAttribute("id")&&(h=lt(l.id),h?k.call(this,null,null,h):at({el:l.id},e,k.bind(this),function(){Nt[e].oldModel=[]}))}else for(o=0;o<n.length;)r=p.cloneNode(!0),i(this,null,r,n[o],null,"update"),r.setAttribute("kdata-id",n[o]["kdata-id"]),l.insertBefore(r,l.lastChild),o++}function h(t,e){var i=t.replace("component:",""),n=this[i];void 0!==n?Tt[n.ID]?lt(this[i].el)?(e.parentNode.replaceChild(Tt[n.ID].cloneNode(!0),e),n.callBatchPoolUpdate()):(n.base=n.__pristineFragment__.cloneNode(!0),n.render(!0),e.parentNode.replaceChild(n.base,e)):(n.render(!0),Tt[n.ID]=n.base.cloneNode(!0),e.parentNode.replaceChild(n.base,e)):dt(!1,"Component "+i+" does not exist.")}function u(t,e){var i=void 0,n=void 0;t.match(At)&&(i=t.replace(At,"$1").trim(),i.match(Dt)?(n=i.replace("model:",""),c.call(this,e,n)):i.match(It)&&h.call(this,i,e))}function f(t,e,i,n){t.nodeValue=t.nodeValue.replace(RegExp(i,"g"),n)}function p(e,i,n,o){for(var r=e.match(Mt),l=r.length,d=void 0,s=void 0,c=void 0;l;)if(l--,d=r[l].replace(Mt,"$1"),s=a.call(this,d),c=_t(d)){if(t(d,n),o)return e.replace(r,this[c[0]][c[1]]);f(i,e,"{{"+d+"}}",this[c[0]][c[1]])}else if(s){if(t(s.state,n),o)return e.replace(r,s.value);f(i,e,"{{"+d+"}}",s.value)}else if(void 0!==this[d]){if(t(d,n),o)return e.replace(r,this[d]);f(i,e,"{{"+d+"}}",this[d])}}function v(t,e){var i=t.attributes,n=0,o=void 0,r=void 0,l=void 0;for(n=i.length;n--;)o=i[n],l=o.localName,r=o.nodeValue,Ot.test(l)?(t.removeAttribute(l),l=p.call(this,l,t,e,!0),t.setAttribute(l,r)):Ot.test(r)&&(r=p.call(this,r,t,e,!0),"checked"===l?(t.checked=""!==r,t.removeAttribute(l)):""===r?t.setAttribute(l,""):t.setAttribute(l,r))}function g(t,e){for(;t;)Pt=t,t=t.nextSibling,Pt.nodeType===Vt?(Pt.hasAttributes()&&v.call(this,Pt,e),g.call(this,Pt.firstChild,e)):Pt.nodeValue.match(Ft)&&(Pt.nodeType===Et?u.call(this,Pt.nodeValue,Pt):p.call(this,Pt.nodeValue,Pt,e))}function m(t,e){g.call(this,t,e)}function b(t,e){for(var i=void 0;e;){if(i=e,e=e.parentNode,i.nodeType===jt&&i.hasAttribute("kdata-id"))return{id:i.getAttribute("kdata-id"),node:i};i.isEqualNode(t)&&(e=null)}}function y(t,e){delete e.isModel;var i=Object.keys(e)[0],n=e[i];void 0!==this[n]&&"function"==typeof this[n]&&t.addEventListener(i,this[n].bind(this),!!e.useCapture)}function C(t,e,i,n){if(n.stopPropagation(),n.target!==n.currentTarget){var o=b(i,n.target);this[e](t.list[Bt(o.id,t)],n.target,o.node,n)}}function k(t,e){delete e.isModel;var i=Object.keys(e)[0],n=e[i];if(void 0!==this[n]&&"function"==typeof this[n]){var o=t.firstChild.nodeValue.replace(wt,"$1").trim();o=o.replace("model:","");t.addEventListener(i,C.bind(this,this[o],n,t),!!e.useCapture)}}function N(t){for(var e=t.attributes,i=0,n=void 0,o=void 0,r=void 0,l=void 0,a=void 0,d=[],s=void 0,c=void 0;i<e.length;)n=e[i],o=n.localName,r=n.nodeValue,/^k-/.test(o)&&(l=o.replace(/^k-/,""),a=r.match(/[a-zA-Z]+(?![^(]*\))/)[0],c=r.match(/\(([^{}]+)\)/),c=c?c[1]:"",s={},s[l]=a,c&&(s[c]=!0),s.isModel=!1,d.push(s),t.hasChildNodes()&&t.firstChild.nodeType!==Ut&&t.firstChild.nodeValue.match(qt)&&(s.isModel=!0)),i++;return d}function x(t){for(var e=this;t;)Rt=t,t=t.nextSibling,Rt.nodeType===Ut&&(Rt.hasAttributes()&&!lt(Rt.id)&&(Lt=N.call(this,Rt),Lt.length&&Lt.map(function(t){return t.isModel?k.call(e,Rt,t):y.call(e,Rt,t)})),x.call(this,Rt.firstChild))}function S(t){x.call(this,t)}function T(t,e){return A(t)&&A(e)||t.isEqualNode(e)}function A(t){return null!=t.getAttribute("data-ignore")}function D(t,e){"INPUT"===t.nodeName&&t.checked!==e.checked&&(t.checked=e.checked)}function I(t,e){for(var i=e.attributes,n={},o=0;o<i.length;)n[i[o].name]=i[o].value,o++;for(var r=t.attributes,l={},a=0;a<r.length;)l[r[a].name]=r[a].value,a++;for(var d in n)t.attributes[d]&&t.attributes[d].name===d&&t.attributes[d].value!==n[d]?t.setAttribute(d,n[d]):t.hasAttribute(d)||t.setAttribute(d,n[d]);for(var s in l)e.attributes[s]&&t.attributes[s]||"evt-data"!==s&&t.removeAttribute(s)}function _(t,e){if(t.nodeType===e.nodeType)if(t.nodeType===$t){if(D(t,e),T(t,e))return;O(t.firstChild,e.firstChild),t.nodeName===e.nodeName?I(t,e):t.parentNode.replaceChild(e,t)}else t.nodeValue!==e.nodeValue&&(t.nodeValue=e.nodeValue);else t.parentNode.replaceChild(e,t)}function M(t,e){return t.length-e-1}function O(t,e){for(var i=0,n=[];e;)i++,Wt=e,e=e.nextSibling,n.push(Wt);for(var o=void 0,r=t&&t.parentNode;t;)if(i--,Ht=t,t=t.nextSibling,o=M(n,i),Ht&&n[o]?_(Ht,n[o]):Ht&&!n[o]&&r.removeChild(Ht),null===t)for(;i>0;)i--,o=M(n,i),r.appendChild(n[o])}function V(t){var e=lt(this.el);e&&!this.IS_STUB&&O(e.firstChild,t)}function E(){Xt[this.ID]&&(Xt[this.ID]=[])}function F(t){Xt[this.ID]=Xt[this.ID]||[],Xt[this.ID].indexOf(t)===-1&&(Xt[this.ID]=Xt[this.ID].concat(t))}function P(t){o.call(this,F.bind(this)),l.call(this,this.base.firstChild),m.call(this,this.base.firstChild,F.bind(this)),S.call(this,this.base.firstChild);var e=t||lt(this.el);e?(e.nodeType===te?e.setAttribute("data-ignore",""):(dt(1===this.base.childNodes.length,"Sub-component should only has a single rootNode."),!this.base.firstChild.hasAttribute("data-ignore")&&this.base.firstChild.setAttribute("data-ignore","")),Qt.call(this),t||e.appendChild(this.base),this.componentDidMount&&"function"==typeof this.componentDidMount&&this.componentDidMount()):dt(!1,'No element with id: "'+this.el+'" exist.')}function j(t){var e=void 0,i=void 0,n=document.createDocumentFragment();if("string"==typeof t)for(e=t.trim().replace(/\s+/g," "),i=document.createElement("div"),i.innerHTML=e;i.firstChild;)n.appendChild(i.firstChild);else"object"===(void 0===t?"undefined":et(t))&&t.nodeType?t.nodeType===ne?n.appendChild(t):t.nodeType===ee?n=t:t.nodeType===ie?n.appendChild(t):dt(!1,"Unable to parse instance, unknown type."):dt(!1,"Parameter is not a string or a html element.");return this.__pristineFragment__=n.cloneNode(!0),this.base=n,E.call(this),this}var w=/\{\{\/([^{}]+)\}\}/g,B=1,U=8,q={},L=1,R=8,$=/\{\{\?([^{}]+)\}\}/g,W=/([^{?])(.*?)(?=\}\})/g,H=void 0,J=void 0,z=void 0,K=void 0,Z=1,G=8,Q=/\{\{\?([^{}]+)\}\}/g,X=/([^{?])(.*?)(?=\}\})/g,Y=void 0,tt=void 0,et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},it=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),nt=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},ot=function(){var t=function(){return(1*Math.random()*1e17).toString(36)};return"KDATA-"+t()+"-"+t()},rt=function(){return(1*Math.random()*1e17).toString(36)},lt=function(t){return document.getElementById(t)},at=function(t,e,i,n){function o(){l=lt(t.el),l&&(clearInterval(d),a=!0,i(t,e,l))}function r(){clearInterval(d),!a&&n&&"function"==typeof n&&n()}var l=lt(t.el),a=!1,d=void 0;return l?l:(d=setInterval(o,0),void setTimeout(r,5))},dt=function(t,e){if(!t)throw Error("(keet) "+e)},st=function(t,e){return t["kdata-id"]!==e["kdata-id"]},ct=function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];this.exec&&"function"==typeof this.exec&&this.exec.apply(null,e)},ht=(function(){function t(t){this.enableFiltering=t||null,this.exec=null,this.model=[],Object.defineProperty(this,"list",{enumerable:!1,configurable:!0,get:function(){return this.model},set:function(t){this.model=t,ct.call(this,this.model,this.listFilter)}}),Object.defineProperty(this,"listFilter",{enumerable:!1,configurable:!0,get:function(){var t=this;return this.prop?this.model.filter(function(e){return e[t.prop]===t.value}):this.model}})}return t.prototype.subscribe=function(t){this.exec=t},t.prototype.add=function(t){this.list=this.list.concat(nt({},t,{"kdata-id":rt()}))},t.prototype.update=function(t){this.list=this.list.map(function(e){return st(e,t)?e:t})},t.prototype.filter=function(t,e){this.prop=t,this.value=e,this.list=this.list.map(function(t){return t})},t.prototype.destroy=function(t){this.list=this.list.filter(function(e){return st(e,t)})},t}(),function(t){return"''"===t||'""'===t||"null"===t?"":t}),ut=RegExp(/(\schecked=")(.*?)(?=")/g),ft="",pt=void 0,vt=void 0,gt=void 0,mt=void 0,bt=void 0,yt=function(t,e){var i=t.match(/{{([^{}]+)}}/g);for(ft=t,gt=0,mt=i.length;gt<mt;gt++)pt=i[gt].replace(/{{([^{}]+)}}/g,"$1"),vt=a.call(e,pt),ft=vt?ft.replace("{{"+pt+"}}",vt.value):ft.replace("{{"+pt+"}}",e[pt]),bt=ft.match(ut),bt&&(ft=17===bt[0].length?ft.replace(' checked="checked"'," checked"):ft.replace(' checked=""',""));return ft},Ct=function(t,e){return t.filter(function(t){return!e.some(function(e){var i=!0;for(var n in e)t[n]!==e[n]&&(i=!1);return i})})},kt=void 0;"function"==typeof document.createRange&&(kt=document.createRange());var Nt={},xt=void 0,St=void 0,Tt={},At=/{{([^{}]+)}}/g,Dt=/^model:/g,It=/^component:([^{}]+)/g,_t=function(t){var e=t.match(/\.*\./g);return e&&e.length>0?t.split("."):void 0},Mt=/{{([^{}]+)}}/g,Ot=/{{([^{}]+)}}/g,Vt=1,Et=8,Ft=/{{([^{}]+)}}/g,Pt=void 0,jt=1,wt=/{{([^{}]+)}}/g,Bt=function(t,e){return e.list.map(function(t){return t["kdata-id"]}).indexOf(t)},Ut=1,qt=/\{\{model:([^{}]+)\}\}/g,Lt=void 0,Rt=void 0,$t=1,Wt=void 0,Ht=void 0,Jt=1,zt=function(){Yt.call(this),this.componentDidUpdate&&"function"==typeof this.componentDidUpdate&&this.componentDidUpdate()},Kt={},Zt=function(t,e){var i=this;Kt[this.ID]=Kt[this.ID]||null,clearTimeout(Kt[this.ID]),Kt[this.ID]=setTimeout(function(){return t.call(i)},e)},Gt=function t(e){var i=this,n=void 0,o=void 0;if(e<Xt[this.ID].length){if(n=Xt[this.ID][e],o=this[n],void 0===o&&(o=_t(n)),o&&Array.isArray(o)){var r=this[o[0]][o[1]];Object.defineProperty(this[o[0]],o[1],{enumerable:!1,configurable:!0,get:function(){return r},set:function(t){r=t,Zt.call(i,zt,Jt)}})}else Object.defineProperty(this,n,{enumerable:!1,configurable:!0,get:function(){return o},set:function(t){o=t,Zt.call(i,zt,Jt)}});e++,t.call(this,e)}},Qt=function(){Gt.call(this,0)},Xt={},Yt=function(){this.base=this.__pristineFragment__.cloneNode(!0),l.call(this,this.base.firstChild),m.call(this,this.base.firstChild,F.bind(this)),S.call(this,this.base.firstChild,!0),V.call(this,this.base.firstChild)},te=1,ee=11,ie=3,ne=1;return window.l=console.log.bind(console),window.tr=console.trace.bind(console),function(){function t(){this.ID=t.indentity}return t.prototype.mount=function(t){return j.call(this,t)},t.prototype.link=function(t){return t||dt(t,"No id is given as parameter."),this.el=t,this.render(),this},t.prototype.render=function(t){this.componentWillMount&&"function"==typeof this.componentWillMount&&this.componentWillMount(),t&&(this.IS_STUB=!0),P.call(this,t)},t.prototype.callBatchPoolUpdate=function(){Zt.call(this,zt,1)},t.prototype.subscribe=function(t){this.exec=t},t.prototype.inform=function(t){this.exec&&"function"==typeof this.exec&&this.exec(t)},it(t,null,[{key:"indentity",get:function(){return ot()}}]),t}()}();
//# sourceMappingURL=keet-min.js.map