
/**
 * Keetjs v4.0.0 Alpha release: https://github.com/keetjs/keet
 * Minimalist view layer for the web
 *
 * <<<<<<<<<<<<<<<<<<<<<<<<<<<<<< Keetjs >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
 *
 * Copyright 2018, Shahrul Nizam Selamat
 * Released under the MIT License.
 */
var keet=function(){"use strict";function t(t,e){"function"==typeof e&&e(t)}function e(t,i){for(var n=void 0;t;)n=t,t=t.nextSibling,n&&n.nodeType===w?n.isEqualNode(i)?(n.remove(),i=i.nextSibling):e(n.firstChild,i):n.isEqualNode(i)&&(n.remove(),i=i.nextSibling)}function i(t,i,n,o,r){var l=void 0,a=void 0,d=void 0,s=document.createDocumentFragment();if("initial"!==n||U.hasOwnProperty(i)){if("conditional-set"===n){if(t.nextSibling.isEqualNode(U[i].frag.firstChild))return;d=U[i].frag.cloneNode(!0),o.call(this,d.firstChild,r),t.parentNode.insertBefore(d,t.nextSibling)}}else for(a=t;a;)l=a,a=a.nextSibling,l.nodeType!==w&&l.nodeValue.match(j)?(a=null,U[i]=U[i]||{},e(this.__pristineFragment__.firstChild,s.firstChild),U[i].frag=s):l.nodeType!==B&&s.appendChild(l)}function n(t){for(;t;)H=t,t=t.nextSibling,H.nodeType===q?n.call(this,H.firstChild):H.nodeType===R&&H.nodeValue.match(L)&&(W=H.nodeValue.trim().match($),J=J.concat(W),z=z.concat(H))}function o(e){J=[],z=[],n.call(this,this.base.firstChild);for(var o=J.length;o>0;)o--,t(J[o],e.bind(this)),i.call(this,z[o],J[o],"initial")}function r(t){if(t.match(/([^?]*)\?([^:]*):([^;]*)|(\s*=\s*)[^;]*/g)){var e=t.split("?"),i=e[0],n=e[1].split(":")[0],o=e[1].split(":")[1];return!!this&&(this[i]?{value:ot(n),state:i}:{value:ot(o),state:i})}return!1}function l(t,e){var i=t.match(/{{([^{}]+)}}/g);for(at=t,ct=0,ut=i.length;ct<ut;ct++){if(dt=i[ct].replace(/{{([^{}]+)}}/g,"$1"),st=r.call(e,dt),ft=rt(dt),st)at=at.replace("{{"+dt+"}}",st.value);else if(ft){if("this"===ft[0]&&"function"==typeof this[ft[1]]){var n=this[ft[1]](e);void 0!==n&&(at=at.replace("{{"+dt+"}}",n))}}else at=at.replace("{{"+dt+"}}",e[dt]);ht=at.match(lt),ht&&(at=17===ht[0].length?at.replace(' checked="checked"'," checked"):at.replace(' checked=""',""))}return at}function a(t,e){return d(t)&&d(e)||t.isEqualNode(e)}function d(t){return null!=t.getAttribute("data-ignore")}function s(t,e){"INPUT"===t.nodeName&&t.checked!==e.checked&&(t.checked=e.checked)}function c(t,e){for(var i=e.attributes,n={},o=0;o<i.length;)n[i[o].name]=i[o].value,o++;for(var r=t.attributes,l={},a=0;a<r.length;)l[r[a].name]=r[a].value,a++;for(var d in n)t.attributes[d]&&t.attributes[d].name===d&&t.attributes[d].value!==n[d]?t.setAttribute(d,n[d]):t.hasAttribute(d)||/^k-/.test(d)||t.setAttribute(d,n[d]);for(var s in l)e.attributes[s]&&t.attributes[s]||t.removeAttribute(s)}function u(t,e){if(t.nodeType===e.nodeType)if(t.nodeType===pt){if(s(t,e),a(t,e))return;f(t.firstChild,e.firstChild),t.nodeName===e.nodeName?c(t,e):t.parentNode.replaceChild(e,t)}else t.nodeValue!==e.nodeValue&&(t.nodeValue=e.nodeValue);else t.parentNode.replaceChild(e,t)}function h(t,e){return t.length-e-1}function f(t,e,i){for(var n=0,o=[];e;)n++,mt=e,e=i?null:e.nextSibling,o.push(mt);for(var r=void 0,l=t&&t.parentNode;t;)if(n--,bt=t,t=i?null:t.nextSibling,r=h(o,n),bt&&o[r]?u(bt,o[r]):bt&&!o[r]&&l.removeChild(bt),null===t)for(;n>0;)n--,r=h(o,n),l.appendChild(o[r])}function p(t){var e=void 0;return"function"==typeof document.createRange&&(e=document.createRange()),e?t.nodeType===vt&&null!==t.nodeValue.match(gt):e}function v(t){var e=Y(this.el);e&&!this.IS_STUB?f(e.firstChild,t):e&&!p(e.firstChild)&&f(e.firstChild,t.firstChild)}function g(t,e,i){f(t,e,i)}function m(t,e){Nt=l.call(this,t,e),xt=kt.createContextualFragment(Nt),xt.firstChild.setAttribute("kdata-id",e["kdata-id"])}function b(t,e,i){var n=t.getElementById(e);n?n.childNodes[1].remove():i||Object.keys(U).map(function(t){return b(U[t].frag,e,!0)})}function y(t,e,i){var n=void 0,o=void 0,r=void 0,l=void 0,a=void 0,d=void 0,s=void 0,c=void 0,u=void 0,h=void 0,f=void 0,p=void 0,v=void 0,y=void 0,k=void 0,C=void 0;if(Ct[e]=Ct[e]||{},v=this[e]&&this[e].enableFiltering?"listFilter":"list",Ct[e][v]||(Ct[e][v]=t.nextSibling.cloneNode(!0)),h=Ct[e][v],Ct[e].str||(Ct[e].str=t.nextSibling.cloneNode(!0).outerHTML,t.nextSibling.remove(),b(this.__pristineFragment__,t.parentNode.id)),f=Ct[e].str,void 0!==this[e]&&this[e].hasOwnProperty(v))if(l=t.parentNode,kt&&!l.hasAttribute("data-ignore")&&l.setAttribute("data-ignore",""),n=this[e][v],p=Ct[e].oldModel||[],kt){a=yt(n,p),d=yt(p,n);var N=function(){for(var t=arguments.length,i=Array(t),r=0;r<t;r++)i[r]=arguments[r];if(s=i.pop(),c=p.length===n.length,c&&2!==s.childNodes.length)for(o=0;o<a.length;)u=s.querySelector(a[o]["kdata-id"]===d[o]["kdata-id"]?'[kdata-id="'+a[o]["kdata-id"]+'"]':'[kdata-id="'+d[o]["kdata-id"]+'"]'),u&&(m.call(this,f,a[o]),g(u,xt.firstChild,!0)),o++;else if(a.length>0&&0===d.length)for(o=0;o<a.length;)m.call(this,f,a[o]),a[o]["kdata-id"]===n[n.length-1]["kdata-id"]?k=s.lastChild:(y=n.map(function(t){return t["kdata-id"]}).indexOf(a[o]["kdata-id"]),k=s.childNodes[y].nextSibling),s.insertBefore(xt,k),o++;else if(0===a.length&&d.length>0)for(o=0;o<d.length;)u=s.querySelector('[kdata-id="'+d[o]["kdata-id"]+'"]'),u&&s.removeChild(u),o++;else if(a.length>0&&d.length>0){for(o=0;o<d.length;)if(u=s.querySelector('[kdata-id="'+d[o]["kdata-id"]+'"]'),u&&s.removeChild(u),o++,o===d.length)for(C=0;C<a.length;)m.call(this,f,a[C]),s.insertBefore(xt,s.lastChild),C++}else for(o=0;o<n.length;)m.call(this,f,n[o]),s.insertBefore(xt,s.lastChild),o++;Ct[e].oldModel=JSON.parse(JSON.stringify(n))};l.hasAttribute("id")&&(s=Y(l.id),s?N.call(this,null,null,s):tt({el:l.id},e,N.bind(this),function(){Ct[e].oldModel=[]}))}else for(o=0;o<n.length;)r=h.cloneNode(!0),i.call(this,r,null,n[o]),r.setAttribute("kdata-id",n[o]["kdata-id"]),l.insertBefore(r,l.lastChild),o++}function k(t,e){var i=t.replace("component:",""),n=this[i];void 0!==n?St[n.ID]?Y(this[i].el)?(e.parentNode.replaceChild(St[n.ID].cloneNode(!0),e),n.callBatchPoolUpdate()):(n.base=n.__pristineFragment__.cloneNode(!0),n.render(!0),e.parentNode.replaceChild(n.base,e)):(n.render(!0),St[n.ID]=n.base.cloneNode(!0),e.parentNode.replaceChild(n.base,e)):et(!1,"Component "+i+" does not exist.")}function C(t,e,i){var n=void 0,o=void 0;t.match(At)&&(n=t.replace(At,"$1").trim(),n.match(Tt)?(o=n.replace("model:",""),y.call(this,e,o,i)):n.match(Dt)&&k.call(this,n,e))}function N(t,e,i,n){t.nodeValue=t.nodeValue.replace(RegExp(i,"g"),n)}function x(e,i,n,o,l){var a=e.match(It);if(a)for(var d=a.length,s=void 0,c=void 0,u=void 0,h=this,f=l||this;d;)if(d--,s=a[d].replace(It,"$1"),c=r.call(f,s),u=rt(s)){if(o){if("this"===u[0]&&void 0!==h[u[1]]&&"function"==typeof h[u[1]]){var p=h[u[1]](f);return void 0!==p?p:e}return t(s,n),e.replace(a,h[u[0]][u[1]])}if("this"===u[0]&&void 0!==h[u[1]]&&"function"==typeof h[u[1]]){var v=h[u[1]]();void 0!==v&&N(i,e,"{{"+s+"}}",v)}else t(s,n),N(i,e,"{{"+s+"}}",h[u[0]][u[1]])}else if(c){if(t(c.state,n),o)return e.replace(a,c.value);N(i,e,"{{"+s+"}}",c.value)}else if(void 0!==f[s]){if(t(s,n),o)return e.replace(a,f[s]);N(i,e,"{{"+s+"}}",f[s])}}function S(t,e,i){var n=t.attributes,o=0,r=void 0,l=void 0,a=void 0;for(o=n.length;o--;)r=n[o],a=r.localName,l=r.nodeValue,_t.test(a)?(t.removeAttribute(a),a=x.call(this,a,t,e,!0,i),t.setAttribute(a,l)):_t.test(l)&&(l=x.call(this,l,t,e,!0,i),"checked"===a?(t.checked=""!==l,t.removeAttribute(a)):""===l?t.setAttribute(a,""):t.setAttribute(a,l))}function A(t,e){for(var i=void 0;e;){if(i=e,e=e.parentNode,i.nodeType===Vt&&i.hasAttribute("kdata-id"))return{id:i.getAttribute("kdata-id"),node:i};i.isEqualNode(t)&&(e=null)}}function T(t,e){delete e.isModel;var i=Object.keys(e)[0],n=e[i];void 0!==this[n]&&"function"==typeof this[n]&&t.addEventListener(i,this[n].bind(this),!!e.useCapture)}function D(t,e,i,n){if(n.stopPropagation(),n.target!==n.currentTarget){var o=A(i,n.target);this[e](t.list[Mt(o.id,t)],n.target,o.node,n)}}function I(t,e){delete e.isModel;var i=Object.keys(e)[0],n=e[i];if(void 0!==this[n]&&"function"==typeof this[n]){var o=t.firstChild.nodeValue.replace(Ot,"$1").trim();o=o.replace("model:","");t.addEventListener(i,D.bind(this,this[o],n,t),!!e.useCapture)}}function _(t){for(var e=t.attributes,i=0,n=void 0,o=void 0,r=void 0,l=void 0,a=void 0,d=[],s=void 0,c=void 0;i<e.length;)n=e[i],o=n.localName,r=n.nodeValue,/^k-/.test(o)&&(l=o.replace(/^k-/,""),a=r.match(/[a-zA-Z]+(?![^(]*\))/)[0],c=r.match(/\(([^{}]+)\)/),c=c?c[1]:"",s={},s[l]=a,c&&(s[c]=!0),s.isModel=!1,d.push(s),t.hasChildNodes()&&t.firstChild.nodeType!==wt&&t.firstChild.nodeValue.match(jt)&&(s.isModel=!0)),i++;return d}function V(t,e,n){for(var o=this;t;)Rt=t,t=t.nextSibling,Rt.nodeType===wt?(Rt.hasAttributes()&&(S.call(this,Rt,e,n),Y(Rt.id)||(Ut=_.call(this,Rt),Ut.length&&Ut.map(function(t){t.isModel?I.call(o,Rt,t):T.call(o,Rt,t),Rt.removeAttribute("k-"+Object.keys(t)[0])}))),V.call(this,Rt.firstChild,e,n)):Rt.nodeType===Bt&&Rt.nodeValue.match(Et)?(qt=Rt.nodeValue.trim().match(Ft),qt=qt&&qt[0],this[qt]&&i.call(this,Rt,qt,"conditional-set",O,e)):Rt.nodeType===Bt&&Rt.nodeValue.match(Pt)&&!Rt.nodeValue.match(Et)?C.call(this,Rt.nodeValue,Rt,O):x.call(this,Rt.nodeValue,Rt,e,null,n)}function O(t,e,i){V.call(this,t,e,i)}function M(){Kt[this.ID]&&(Kt[this.ID]=[])}function E(t){Kt[this.ID]=Kt[this.ID]||[],Kt[this.ID].indexOf(t)===-1&&(Kt[this.ID]=Kt[this.ID].concat(t))}function F(t){o.call(this,E.bind(this)),O.call(this,this.base.firstChild,E.bind(this));var e=t||Y(this.el);e?(e.nodeType===Gt?e.setAttribute("data-ignore",""):(et(1===this.base.childNodes.length,"Sub-component should only has a single rootNode."),!this.base.firstChild.hasAttribute("data-ignore")&&this.base.firstChild.setAttribute("data-ignore","")),zt.call(this),t||e.appendChild(this.base),this.componentDidMount&&"function"==typeof this.componentDidMount&&this.componentDidMount()):et(!1,'No element with id: "'+this.el+'" exist.')}function P(t){var e=void 0,i=void 0,n=document.createDocumentFragment();if("string"==typeof t)for(e=t.trim().replace(/\s+/g," "),i=document.createElement("div"),i.innerHTML=e;i.firstChild;)n.appendChild(i.firstChild);else"object"===(void 0===t?"undefined":K(t))&&t.nodeType?t.nodeType===Yt?n.appendChild(t):t.nodeType===Qt?n=t:t.nodeType===Xt?n.appendChild(t):et(!1,"Unable to parse instance, unknown type."):et(!1,"Parameter is not a string or a html element.");return this.__pristineFragment__=n.cloneNode(!0),this.base=n,M.call(this),this}var j=/\{\{\/([^{}]+)\}\}/g,w=1,B=8,U={},q=1,R=8,L=/\{\{\?([^{}]+)\}\}/g,$=/([^{?])(.*?)(?=\}\})/g,W=void 0,H=void 0,J=void 0,z=void 0,K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Z=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),G=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},Q=function(){var t=function(){return(1*Math.random()*1e17).toString(36)};return"KDATA-"+t()+"-"+t()},X=function(){return(1*Math.random()*1e17).toString(36)},Y=function(t){return document.getElementById(t)},tt=function(t,e,i,n){function o(){l=Y(t.el),l&&(clearInterval(d),a=!0,i(t,e,l))}function r(){clearInterval(d),!a&&n&&"function"==typeof n&&n()}var l=Y(t.el),a=!1,d=void 0;return l?l:(d=setInterval(o,0),void setTimeout(r,5))},et=function(t,e){if(!t)throw Error("(keet) "+e)},it=function(t,e){return t["kdata-id"]!==e["kdata-id"]},nt=function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];this.exec&&"function"==typeof this.exec&&this.exec.apply(null,e)},ot=(function(){function t(t){this.enableFiltering=t||null,this.exec=null,this.model=[],Object.defineProperty(this,"list",{enumerable:!1,configurable:!0,get:function(){return this.model},set:function(t){this.model=t,nt.call(this,this.model,this.listFilter)}}),Object.defineProperty(this,"listFilter",{enumerable:!1,configurable:!0,get:function(){var t=this;return this.prop?this.model.filter(function(e){return e[t.prop]===t.value}):this.model}})}return t.prototype.subscribe=function(t){this.exec=t},t.prototype.add=function(t){this.list=this.list.concat(G({},t,{"kdata-id":X()}))},t.prototype.update=function(t){this.list=this.list.map(function(e){return it(e,t)?e:t})},t.prototype.filter=function(t,e){this.prop=t,this.value=e,this.list=this.list.map(function(t){return t})},t.prototype.destroy=function(t){this.list=this.list.filter(function(e){return it(e,t)})},t}(),function(t){return"''"===t||'""'===t||"null"===t?"":t}),rt=function(t){var e=t.match(/\.*\./g);return e&&e.length>0?t.split("."):void 0},lt=RegExp(/(\schecked=")(.*?)(?=")/g),at="",dt=void 0,st=void 0,ct=void 0,ut=void 0,ht=void 0,ft=void 0,pt=1,vt=8,gt=/\{\{model:([^{}]+)\}\}/g,mt=void 0,bt=void 0,yt=function(t,e){return t.filter(function(t){return!e.some(function(e){var i=!0;for(var n in e)t[n]!==e[n]&&(i=!1);return i})})},kt=void 0;"function"==typeof document.createRange&&(kt=document.createRange());var Ct={},Nt=void 0,xt=void 0,St={},At=/{{([^{}]+)}}/g,Tt=/^model:/g,Dt=/^component:([^{}]+)/g,It=/{{([^{}]+)}}/g,_t=/{{([^{}]+)}}/g,Vt=1,Ot=/{{([^{}]+)}}/g,Mt=function(t,e){return e.list.map(function(t){return t["kdata-id"]}).indexOf(t)},Et=/\{\{\?([^{}]+)\}\}/g,Ft=/([^{?])(.*?)(?=\}\})/g,Pt=/{{([^{}]+)}}/g,jt=/\{\{model:([^{}]+)\}\}/g,wt=1,Bt=8,Ut=void 0,qt=void 0,Rt=void 0,Lt=0,$t=function(){Zt.call(this),this.componentDidUpdate&&"function"==typeof this.componentDidUpdate&&this.componentDidUpdate()},Wt={},Ht=function(t,e){var i=this;Wt[this.ID]=Wt[this.ID]||null,clearTimeout(Wt[this.ID]),Wt[this.ID]=setTimeout(function(){return t.call(i)},e)},Jt=function t(e){var i=this,n=void 0,o=void 0;if(Kt[this.ID]&&e<Kt[this.ID].length){if(n=Kt[this.ID][e],o=this[n],void 0===o&&(o=rt(n)),o&&Array.isArray(o)){var r=this[o[0]][o[1]];Object.defineProperty(this[o[0]],o[1],{enumerable:!1,configurable:!0,get:function(){return r},set:function(t){r=t,Ht.call(i,$t,Lt)}})}else Object.defineProperty(this,n,{enumerable:!1,configurable:!0,get:function(){return o},set:function(t){o=t,Ht.call(i,$t,Lt)}});e++,t.call(this,e)}},zt=function(){Jt.call(this,0)},Kt={},Zt=function(){this.base=this.__pristineFragment__.cloneNode(!0),O.call(this,this.base.firstChild,E.bind(this)),v.call(this,this.base.firstChild)},Gt=1,Qt=11,Xt=3,Yt=1;window.l=console.log.bind(console),window.tr=console.trace.bind(console);(function(){function t(){this.ID=t.indentity}return t.prototype.mount=function(t){return P.call(this,t)},t.prototype.link=function(t){return t||et(t,"No id is given as parameter."),this.el=t,this.render(),this},t.prototype.render=function(t){this.componentWillMount&&"function"==typeof this.componentWillMount&&this.componentWillMount(),t&&(this.IS_STUB=!0),F.call(this,t)},t.prototype.callBatchPoolUpdate=function(){Ht.call(this,$t,1)},t.prototype.subscribe=function(t){this.exec=t},t.prototype.inform=function(t){this.exec&&"function"==typeof this.exec&&this.exec(t)},Z(t,null,[{key:"indentity",get:function(){return Q()}}]),t})();return{}}();
//# sourceMappingURL=keet-min.js.map