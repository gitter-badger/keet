{"version":3,"sources":["src/components/ternaryOps.js","src/components/templateParse/updateState.js","src/components/templateParse/valAssign.js","src/components/templateParse/replaceHandleBars.js","src/components/conditionalNodes.js","src/components/genModelList.js","src/components/componentParse.js","src/components/templateParse/replaceCommentBlock.js","src/components/templateParse/addEvent.js","src/components/templateParse/index.js","src/components/parseStr.js","src/base/mount.js","src/components/strInterpreter.js","utils.js","src/components/genModelTemplate.js","src/components/genElement.js","keet.js"],"names":["ternaryOps","input","match","t","split","condition","leftHand","rightHand","this","value","test","state","updateState","updateStateList","valAssign","node","replace","withTo","nodeValue","RegExp","replaceHandleBars","ins","templateParse","isAttr","props","re","ln","length","rep","tnr","isObjectNotation","call","strInterpreter","undefined","catchNode","start","cNode","nextSibling","nodeType","DOCUMENT_ELEMENT_TYPE","isEqualNode","remove","firstChild","resolveConditionalNodes","conditional","setup","currentNode","fetchFrag","frag","document","createDocumentFragment","cache","hasOwnProperty","cloneNode","parentNode","insertBefore","conditionalNodesRawEnd","__pristineFragment__","Object","keys","map","c","DOCUMENT_COMMENT_TYPE","appendChild","render","str","obj","m","genModelTemplate","documentFragment","range","createContextualFragment","setAttribute","removeProtoModel","id","after","p","getElementById","childNodes","conditionalCache","cache$$1","genModelList","model","modelList","i","listClone","updateOfNew","diffOfOld","pNode","equalLength","child","list","oldModel","listArg","idx","beforeNode","f","enableFiltering","outerHTML","hasAttribute","diff","diffModel","_len","arguments","args","Array","_key","pop","querySelector","replaceChild","lastChild","indexOf","removeChild","JSON","parse","stringify","getId","checkNodeAvailability","el","bind","componentParse","componentStr","component","cacheInit","ID","callBatchPoolUpdate","base","assert","replaceCommentBlock","conditionalRep","modelRep","trim","conditionalRe","conditionalNodes","lookupParentNode","rootNode","getAttribute","addEvent","evtData","isModel","evtName","handler","addEventListener","fn","e","stopPropagation","target","currentTarget","getIndex","addEventModel","ctx","modelInstance","modelObject","type","isEqual","oldNode","newNode","isIgnored","arbiter","nodeName","checked","setAttr","oAttr","attributes","output","name","iAttr","j","attr","removeAttribute","patch","store","count","newStore","checkNew","push","index","oldParentNode","checkOld","fragment","instance","inspectAttributes","nodeAttributes","a","ns","localName","testEventNode","evtStore","obs","hasChildNodes","modelRaw","rd","minId","cacheEvents","events","addEvt","hasAttributes","check","IS_STUB","parseStr","stub","addState","setState","componentDidMount","_mount","tempDiv","createElement","innerHTML","_typeof","DOCUMENT_FRAGMENT_TYPE","DOCUMENT_TEXT_TYPE","clearState","res","result","genId","Math","random","toString","componentName","callback","notFound","find","ele","clearInterval","found","fail","setInterval","setTimeout","val","msg","Error","notEqual","b","inform","_len2","_key2","exec","apply","createModel","defineProperty","enumerable","configurable","get","set","listFilter","_this","prop","filter","subscribe","add","concat","_extends","kdata-id","update","updateObj","destroy","destroyObj","tmpl","isTernary","len","string","arrProps","fst","sec","some","inr","predicate","createRange","DELAY","morpher","genElement","componentDidUpdate","timer","updateContext","delay","clearTimeout","nextState","self","stateList","isArray","inVal","Keet","indentity","mount","link","componentWillMount"],"mappings":"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","file":"keet-min.js","sourcesContent":["// function to resolve ternary operation\r\n\r\nconst test = str => str === '\\'\\'' || str === '\"\"' || str === 'null' ? '' : str\r\n\r\nexport default function (input) {\r\n  if (input.match(/([^?]*)\\?([^:]*):([^;]*)|(\\s*=\\s*)[^;]*/g)) {\r\n    let t = input.split('?')\r\n    let condition = t[0]\r\n    let leftHand = t[1].split(':')[0]\r\n    let rightHand = t[1].split(':')[1]\r\n\r\n    // check the condition fulfillment\r\n\r\n    if (this) {\r\n      if (this[condition]) {\r\n        return {\r\n          value: test(leftHand),\r\n          state: condition\r\n        }\r\n      } else {\r\n        return {\r\n          value: test(rightHand),\r\n          state: condition\r\n        }\r\n      }\r\n    }\r\n    return false\r\n  } else return false\r\n}\r\n","export default function (state, updateStateList) {\r\n  if (typeof updateStateList === 'function') updateStateList(state)\r\n}\r\n","export default function (node, value, replace, withTo) {\r\n  let re = new RegExp(replace, 'g')\r\n  node.nodeValue = node.nodeValue.replace(re, withTo)\r\n}\r\n","import ternaryOps from '../ternaryOps'\r\nimport strInterpreter from '../strInterpreter'\r\nimport updateState from './updateState'\r\nimport valAssign from './valAssign'\r\n\r\nconst re = /{{([^{}]+)}}/g\r\n\r\nexport default function (value, node, ins, updateStateList, templateParse, isAttr) {\r\n  const props = value.match(re)\r\n  let ln = props.length\r\n  let rep\r\n  let tnr\r\n  let isObjectNotation\r\n\r\n  while (ln) {\r\n    ln--\r\n    rep = props[ln].replace(re, '$1')\r\n    tnr = ternaryOps.call(ins, rep)\r\n    isObjectNotation = strInterpreter(rep)\r\n    if (isObjectNotation) {\r\n      updateState(rep, updateStateList)\r\n      if (!isAttr) {\r\n        valAssign(node, value, '{{' + rep + '}}', ins[isObjectNotation[0]][isObjectNotation[1]])\r\n      } else {\r\n        return value.replace(props, ins[isObjectNotation[0]][isObjectNotation[1]])\r\n      }\r\n    } else {\r\n      if (tnr) {\r\n        updateState(tnr.state, updateStateList)\r\n        if (!isAttr) {\r\n          valAssign(node, value, '{{' + rep + '}}', tnr.value)\r\n        } else {\r\n          return value.replace(props, tnr.value)\r\n        }\r\n      } else {\r\n        if (ins[rep] !== undefined) {\r\n          updateState(rep, updateStateList)\r\n          if (!isAttr) {\r\n            valAssign(node, value, '{{' + rep + '}}', ins[rep])\r\n          } else {\r\n            return value.replace(props, ins[rep])\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","const conditionalNodesRawEnd = /\\{\\{\\/([^{}]+)\\}\\}/g\r\nconst DOCUMENT_ELEMENT_TYPE = 1\r\nconst DOCUMENT_COMMENT_TYPE = 8\r\n\r\nlet cache = {}\r\n\r\n// rebuild the node structure\r\nfunction catchNode (node, start) {\r\n  let cNode\r\n  while (node) {\r\n    cNode = node\r\n    node = node.nextSibling\r\n    if (cNode && cNode.nodeType === DOCUMENT_ELEMENT_TYPE) {\r\n      if (cNode.isEqualNode(start)) {\r\n        cNode.remove()\r\n        start = start.nextSibling\r\n      } else {\r\n        catchNode(cNode.firstChild, start)\r\n      }\r\n    } else if (cNode.isEqualNode(start)) {\r\n      cNode.remove()\r\n      start = start.nextSibling\r\n    }\r\n  }\r\n}\r\n\r\nfunction resolveConditionalNodes (node, updateStateList, conditional, templateParse, setup) {\r\n  let currentNode\r\n  let cNode\r\n  let fetchFrag\r\n  let frag = document.createDocumentFragment()\r\n\r\n  if (setup === 'initial' && !cache.hasOwnProperty(conditional)) {\r\n    cNode = node\r\n    while (cNode) {\r\n      currentNode = cNode\r\n      cNode = cNode.nextSibling\r\n      if (currentNode.nodeType !== DOCUMENT_ELEMENT_TYPE && currentNode.nodeValue.match(conditionalNodesRawEnd)) {\r\n        cNode = null\r\n        cache[conditional] = cache[conditional] || {}\r\n\r\n        // clean up pristine node\r\n        catchNode(this.__pristineFragment__.firstChild, frag.firstChild)\r\n        // also clean up cache for recursive handlers\r\n        Object.keys(cache).map(c =>\r\n          c !== conditional && catchNode(cache[c].frag.firstChild, frag.firstChild)\r\n        )\r\n\r\n        cache[conditional].frag = frag\r\n        fetchFrag = cache[conditional].frag.cloneNode(true)\r\n        // resolve recursive conditional handlers as well\r\n        templateParse(this, null, null, null, fetchFrag, 'initial')\r\n        // update current if conditional is truthy\r\n        if (this[conditional]) {\r\n          currentNode.parentNode.insertBefore(fetchFrag, currentNode)\r\n        }\r\n      } else if (currentNode.nodeType !== DOCUMENT_COMMENT_TYPE) {\r\n        frag.appendChild(currentNode)\r\n      }\r\n    }\r\n  } else {\r\n    if (node.nextSibling.isEqualNode(cache[conditional].frag.firstChild)) return\r\n    fetchFrag = cache[conditional].frag.cloneNode(true)\r\n    if (this[conditional]) {\r\n      node.parentNode.insertBefore(fetchFrag, node.nextSibling)\r\n    } else {\r\n      // templateParse(this, null, null, null, fetchFrag, 'update')\r\n    }\r\n  }\r\n}\r\n\r\nexport {\r\n  resolveConditionalNodes as default,\r\n  cache\r\n}\r\n","import { getId, checkNodeAvailability } from '../../utils'\r\nimport genModelTemplate from './genModelTemplate'\r\nimport { cache as conditionalCache } from './conditionalNodes'\r\n\r\n// diffing two array of objects, including object properties differences\r\nconst diff = (fst, sec) =>\r\n  fst.filter(obj =>\r\n    !sec.some(inr => {\r\n      let predicate = true\r\n      for (let attr in inr) {\r\n        if (obj[attr] !== inr[attr]) {\r\n          predicate = false\r\n        }\r\n      }\r\n      return predicate\r\n    })\r\n  )\r\n\r\n// check if browser support createRange\r\nlet range\r\n\r\nif (typeof document.createRange === 'function') {\r\n  range = document.createRange()\r\n}\r\n\r\n// storage for model state\r\nlet cache = {}\r\nlet m\r\nlet documentFragment\r\n\r\nfunction render (str, obj) {\r\n  m = genModelTemplate(str, obj)\r\n  documentFragment = range.createContextualFragment(m)\r\n  documentFragment.firstChild.setAttribute('kdata-id', obj['kdata-id'])\r\n}\r\n\r\nfunction removeProtoModel (node, id, after) {\r\n  let p = node.getElementById(id)\r\n  if (p) p.childNodes[1].remove()\r\n  else if (!after) {\r\n    Object.keys(conditionalCache).map(cache =>\r\n      removeProtoModel(conditionalCache[cache].frag, id, true)\r\n    )\r\n  }\r\n}\r\n\r\nfunction genModelList (node, model, templateParse) {\r\n  let modelList\r\n  let i\r\n  let listClone\r\n  let parentNode\r\n  let updateOfNew\r\n  let diffOfOld\r\n  let pNode\r\n  let equalLength\r\n  let child\r\n  let list\r\n  let str\r\n  let oldModel\r\n  let listArg\r\n  let idx\r\n  let beforeNode\r\n  let f\r\n\r\n  cache[model] = cache[model] || {}\r\n\r\n  // check if the model use filtering\r\n  listArg = this[model] && this[model].enableFiltering ? 'listFilter' : 'list'\r\n\r\n  if (!cache[model][listArg]) {\r\n    cache[model][listArg] = node.nextSibling.cloneNode(true)\r\n  }\r\n  list = cache[model][listArg]\r\n\r\n  if (!cache[model].str) {\r\n    cache[model].str = node.nextSibling.cloneNode(true).outerHTML\r\n    // remove the first prototype node\r\n    node.nextSibling.remove()\r\n    // also remove from pristine nodes / conditional cache store\r\n    removeProtoModel(this.__pristineFragment__, node.parentNode.id)\r\n  }\r\n  str = cache[model].str\r\n\r\n  if (this[model] !== undefined && this[model].hasOwnProperty(listArg)) {\r\n    parentNode = node.parentNode\r\n\r\n    if (range && !parentNode.hasAttribute('data-ignore')) {\r\n      parentNode.setAttribute('data-ignore', '')\r\n    }\r\n\r\n    modelList = this[model][listArg]\r\n\r\n    oldModel = cache[model].oldModel || []\r\n\r\n    // check if current browser doesn't support createRange()\r\n    if (!range) {\r\n      i = 0\r\n      while (i < modelList.length) {\r\n        // fallback to regular node generation handler\r\n        listClone = list.cloneNode(true)\r\n        templateParse(this, null, listClone, modelList[i], null, 'update')\r\n        listClone.setAttribute('kdata-id', modelList[i]['kdata-id'])\r\n        parentNode.insertBefore(listClone, parentNode.lastChild)\r\n        i++\r\n      }\r\n    } else {\r\n      updateOfNew = diff(modelList, oldModel)\r\n      diffOfOld = diff(oldModel, modelList)\r\n\r\n      const diffModel = function (...args) {\r\n        pNode = args.pop()\r\n        // check if both models are equally in length\r\n        equalLength = oldModel.length === modelList.length\r\n\r\n        if (equalLength && pNode.childNodes.length !== 2) {\r\n          i = 0\r\n          while (i < updateOfNew.length) {\r\n            if (updateOfNew[i]['kdata-id'] === diffOfOld[i]['kdata-id']) {\r\n              // equal node element id\r\n              child = pNode.querySelector(`[kdata-id=\"${updateOfNew[i]['kdata-id']}\"]`)\r\n            } else {\r\n              // replace if it doesn't share the same id\r\n              child = pNode.querySelector(`[kdata-id=\"${diffOfOld[i]['kdata-id']}\"]`)\r\n            }\r\n            if (child) {\r\n              render(str, updateOfNew[i])\r\n              pNode.replaceChild(documentFragment, child)\r\n            }\r\n            i++\r\n          }\r\n        // add new objects\r\n        } else if (updateOfNew.length > 0 && diffOfOld.length === 0) {\r\n          i = 0\r\n          while (i < updateOfNew.length) {\r\n            render(str, updateOfNew[i])\r\n            if (updateOfNew[i]['kdata-id'] === modelList[modelList.length - 1]['kdata-id']) {\r\n              beforeNode = pNode.lastChild\r\n            } else {\r\n              idx = modelList.map(m => m['kdata-id']).indexOf(updateOfNew[i]['kdata-id'])\r\n              beforeNode = pNode.childNodes[idx].nextSibling\r\n            }\r\n            pNode.insertBefore(documentFragment, beforeNode)\r\n            i++\r\n          }\r\n        // destroy selected objects\r\n        } else if (updateOfNew.length === 0 && diffOfOld.length > 0) {\r\n          i = 0\r\n          while (i < diffOfOld.length) {\r\n            child = pNode.querySelector(`[kdata-id=\"${diffOfOld[i]['kdata-id']}\"]`)\r\n            if (child) {\r\n              pNode.removeChild(child)\r\n            }\r\n            i++\r\n          }\r\n        } else if (updateOfNew.length > 0 && diffOfOld.length > 0) {\r\n          // if both differences has length we remove the old children and replace it with the new ones\r\n          i = 0\r\n          while (i < diffOfOld.length) {\r\n            child = pNode.querySelector(`[kdata-id=\"${diffOfOld[i]['kdata-id']}\"]`)\r\n            if (child) {\r\n              pNode.removeChild(child)\r\n            }\r\n            i++\r\n            if (i === diffOfOld.length) {\r\n              f = 0\r\n              while (f < updateOfNew.length) {\r\n                render(str, updateOfNew[f])\r\n                pNode.insertBefore(documentFragment, pNode.lastChild)\r\n                f++\r\n              }\r\n            }\r\n          }\r\n        } else {\r\n          i = 0\r\n          while (i < modelList.length) {\r\n            render(str, modelList[i])\r\n            pNode.insertBefore(documentFragment, pNode.lastChild)\r\n            i++\r\n          }\r\n        }\r\n        // replace oldModel after diffing\r\n        cache[model].oldModel = JSON.parse(JSON.stringify(modelList))\r\n      }\r\n\r\n      // check existing parentNode in the DOM\r\n      if (parentNode.hasAttribute('id')) {\r\n        pNode = getId(parentNode.id)\r\n        if (pNode) {\r\n          diffModel.call(this, null, null, pNode)\r\n        } else {\r\n          checkNodeAvailability({ el: parentNode.id }, model, diffModel.bind(this), function () {\r\n            // we cleanup cache on failed search\r\n            cache[model].oldModel = []\r\n          })\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport default genModelList\r\n","import { assert, getId } from '../../utils'\r\n\r\nlet cacheInit = {}\r\n\r\nexport default function (componentStr, node) {\r\n  const component = componentStr.replace('component:', '')\r\n  const c = this[component]\r\n\r\n  if (c !== undefined) {\r\n    // this is for initial component runner\r\n    if (!cacheInit[c.ID]) {\r\n      c.render(true)\r\n      cacheInit[c.ID] = c.base.cloneNode(true)\r\n      node.parentNode.replaceChild(c.base, node)\r\n    } else {\r\n      // we need to reattach event listeners if the node is not available on DOM\r\n      if (!getId(this[component].el)) {\r\n        c.base = c.__pristineFragment__.cloneNode(true)\r\n        c.render(true)\r\n        node.parentNode.replaceChild(c.base, node)\r\n      } else {\r\n        node.parentNode.replaceChild(cacheInit[c.ID].cloneNode(true), node)\r\n        // inform sub-component to update\r\n        c.callBatchPoolUpdate()\r\n      }\r\n    }\r\n  } else {\r\n    assert(false, 'Component ' + component + ' does not exist.')\r\n  }\r\n}\r\n","import genModelList from '../genModelList'\r\nimport conditionalNodes from '../conditionalNodes'\r\nimport updateState from './updateState'\r\nimport componentParse from '../componentParse'\r\n\r\nconst re = /{{([^{}]+)}}/g\r\nconst model = /^model:/g\r\nconst conditionalRe = /^\\?/g\r\nconst component = /^component:([^{}]+)/g\r\n\r\nexport default function (value, node, ins, updateStateList, templateParse, setup) {\r\n  let conditionalRep\r\n  let rep\r\n  let modelRep\r\n\r\n  if (value.match(re)) {\r\n    rep = value.replace(re, '$1').trim()\r\n    if (rep.match(model) && setup !== 'initial') {\r\n      modelRep = rep.replace('model:', '')\r\n      genModelList.call(this, node, modelRep, templateParse)\r\n    } else if (rep.match(conditionalRe)) {\r\n      conditionalRep = rep.replace('?', '')\r\n      if (ins[conditionalRep] !== undefined) {\r\n        updateState(conditionalRep, updateStateList)\r\n        conditionalNodes.call(this, node, updateStateList, conditionalRep, templateParse, setup)\r\n      }\r\n    } else if (rep.match(component) && setup !== 'initial') {\r\n      componentParse.call(this, rep, node)\r\n    }\r\n  }\r\n}\r\n","const DOCUMENT_ELEMENT_TYPE = 1\r\nconst re = /{{([^{}]+)}}/g\r\n\r\nfunction lookupParentNode (rootNode, node) {\r\n  let cNode\r\n  while (node) {\r\n    cNode = node\r\n    node = node.parentNode\r\n    if (cNode.nodeType === DOCUMENT_ELEMENT_TYPE && cNode.hasAttribute('kdata-id')) {\r\n      return { id: cNode.getAttribute('kdata-id'), node: cNode }\r\n    }\r\n    if (cNode.isEqualNode(rootNode)) {\r\n      node = null\r\n    }\r\n  }\r\n}\r\n\r\nconst getIndex = (id, model) => model.list.map(m => m['kdata-id']).indexOf(id)\r\n\r\nfunction addEvent (node, evtData) {\r\n  delete evtData.isModel\r\n  let evtName = Object.keys(evtData)[0]\r\n  let handler = evtData[evtName]\r\n  if (this[handler] !== undefined && typeof this[handler] === 'function') {\r\n    node.addEventListener(evtName, this[handler].bind(this), !!evtData['useCapture'])\r\n  }\r\n}\r\n\r\nfunction fn (model, handler, node, e) {\r\n  e.stopPropagation()\r\n  if (e.target !== e.currentTarget) {\r\n    let t = lookupParentNode(node, e.target)\r\n    this[handler](model.list[getIndex(t.id, model)], e.target, t.node, e)\r\n  }\r\n}\r\n\r\nfunction addEventModel (node, evtData) {\r\n  delete evtData.isModel\r\n  let evtName = Object.keys(evtData)[0]\r\n  let handler = evtData[evtName]\r\n  if (this[handler] !== undefined && typeof this[handler] === 'function') {\r\n    let rep = node.firstChild.nodeValue.replace(re, '$1').trim()\r\n    rep = rep.replace('model:', '')\r\n    let model = this[rep]\r\n    node.addEventListener(evtName, fn.bind(this, model, handler, node), !!evtData['useCapture'])\r\n  }\r\n}\r\n\r\nexport {\r\n  addEvent,\r\n  addEventModel\r\n}\r\n","import replaceHandleBars from './replaceHandleBars'\r\nimport replaceCommentBlock from './replaceCommentBlock'\r\nimport { addEvent, addEventModel } from './addEvent'\r\nimport { getId, minId } from '../../../utils'\r\n\r\nconst DOCUMENT_ELEMENT_TYPE = 1\r\nconst DOCUMENT_COMMENT_TYPE = 8\r\nconst re = /{{([^{}]+)}}/g\r\nconst modelRaw = /\\{\\{model:([^{}]+)\\}\\}/g\r\n\r\nlet cacheEvents = []\r\n\r\nfunction templateParse (ctx, updateStateList, modelInstance, modelObject, conditional, type) {\r\n  let currentNode\r\n  let fragment\r\n  let instance\r\n\r\n  if (modelObject) {\r\n    instance = modelInstance\r\n  } else if (conditional) {\r\n    instance = conditional.firstChild\r\n  } else {\r\n    fragment = ctx.base\r\n    instance = fragment.firstChild\r\n  }\r\n\r\n  let ins = modelObject || ctx\r\n\r\n  const inspectAttributes = node => {\r\n    let nodeAttributes = node.attributes\r\n    let i = 0\r\n    let a\r\n    let ns\r\n    let name\r\n\r\n    for (i = nodeAttributes.length; i--;) {\r\n      a = nodeAttributes[i]\r\n      name = a.localName\r\n      ns = a.nodeValue\r\n      if (re.test(name)) {\r\n        node.removeAttribute(name)\r\n        name = replaceHandleBars(name, node, ins, null, null, true)\r\n        node.setAttribute(name, ns)\r\n      } else if (re.test(ns)) {\r\n        ns = replaceHandleBars(ns, node, ins, null, null, true)\r\n        if (name === 'checked') {\r\n          if (ns === '') {\r\n            node.checked = false\r\n          } else {\r\n            node.checked = true\r\n          }\r\n          node.removeAttribute(name)\r\n        } else {\r\n          if (ns === '') {\r\n            node.setAttribute(name, '')\r\n          } else {\r\n            node.setAttribute(name, ns)\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  const testEventNode = node => {\r\n    let nodeAttributes = node.attributes\r\n    let i = 0\r\n    let a\r\n    let name\r\n    let value\r\n    let evtName\r\n    let handler\r\n    let evtStore = []\r\n    let obs\r\n    let args\r\n\r\n    while (i < nodeAttributes.length) {\r\n      a = nodeAttributes[i]\r\n      name = a.localName\r\n      value = a.nodeValue\r\n      if (/^k-/.test(name)) {\r\n        evtName = name.replace(/^k-/, '')\r\n        handler = value.match(/[a-zA-Z]+(?![^(]*\\))/)[0]\r\n        args = value.match(/\\(([^{}]+)\\)/)\r\n        args = args ? args[1] : ''\r\n        obs = {}\r\n        obs[evtName] = handler\r\n        if (args) obs[args] = true\r\n        obs['isModel'] = false\r\n        evtStore.push(obs)\r\n        if (node.hasChildNodes() && node.firstChild.nodeType !== DOCUMENT_ELEMENT_TYPE && node.firstChild.nodeValue.match(modelRaw)) {\r\n          obs['isModel'] = true\r\n        }\r\n      }\r\n      i++\r\n    }\r\n    if (evtStore.length && !node.hasAttribute('evt-data')) {\r\n      let rd = minId()\r\n      node.setAttribute('evt-data', rd)\r\n      cacheEvents[rd] = evtStore\r\n    }\r\n    return evtStore\r\n  }\r\n\r\n  let events\r\n\r\n  const addEvt = (node, type) => {\r\n    while (node) {\r\n      currentNode = node\r\n      node = node.nextSibling\r\n      if (currentNode.nodeType === DOCUMENT_ELEMENT_TYPE) {\r\n        if (currentNode.hasAttributes() && !getId(currentNode.id)) {\r\n          events = testEventNode.call(ctx, currentNode)\r\n          if (events.length) {\r\n            events.map(e =>\r\n              !e.isModel ? addEvent.call(ctx, currentNode, e) : addEventModel.call(ctx, currentNode, e)\r\n            )\r\n          }\r\n        }\r\n        addEvt(currentNode.firstChild, type)\r\n      }\r\n    }\r\n  }\r\n\r\n  const check = (node, type) => {\r\n    while (node) {\r\n      currentNode = node\r\n      node = node.nextSibling\r\n      if (currentNode.nodeType === DOCUMENT_ELEMENT_TYPE) {\r\n        if (type === 'update' && currentNode.hasAttributes()) {\r\n          inspectAttributes(currentNode)\r\n        }\r\n        check(currentNode.firstChild, type)\r\n      } else if (currentNode.nodeValue.match(re)) {\r\n        if (currentNode.nodeType === DOCUMENT_COMMENT_TYPE) {\r\n          replaceCommentBlock.call(ctx, currentNode.nodeValue, currentNode, ins, updateStateList, templateParse, type)\r\n        } else if (type === 'update') {\r\n          replaceHandleBars.call(ctx, currentNode.nodeValue, currentNode, ins, updateStateList, templateParse)\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  function isEqual (oldNode, newNode) {\r\n    return (\r\n      (isIgnored(oldNode) && isIgnored(newNode)) ||\r\n      oldNode.isEqualNode(newNode)\r\n    )\r\n  }\r\n\r\n  function isIgnored (node) {\r\n    return node.getAttribute('data-ignore') != null\r\n  }\r\n\r\n  function arbiter (oldNode, newNode) {\r\n    if (oldNode.nodeName !== 'INPUT') return\r\n    if (oldNode.checked !== newNode.checked) {\r\n      oldNode.checked = newNode.checked\r\n    }\r\n  }\r\n\r\n  function setAttr (oldNode, newNode) {\r\n    let oAttr = newNode.attributes\r\n    let output = {}\r\n    let i = 0\r\n    while (i < oAttr.length) {\r\n      output[oAttr[i].name] = oAttr[i].value\r\n      i++\r\n    }\r\n    let iAttr = oldNode.attributes\r\n    let input = {}\r\n    let j = 0\r\n    while (j < iAttr.length) {\r\n      input[iAttr[j].name] = iAttr[j].value\r\n      j++\r\n    }\r\n    for (let attr in output) {\r\n      if (oldNode.attributes[attr] && oldNode.attributes[attr].name === attr && oldNode.attributes[attr].value !== output[attr]) {\r\n        oldNode.setAttribute(attr, output[attr])\r\n      } else {\r\n        if (!oldNode.hasAttribute(attr)) {\r\n          oldNode.setAttribute(attr, output[attr])\r\n        }\r\n      }\r\n    }\r\n    for (let attr in input) {\r\n      if (newNode.attributes[attr] && oldNode.attributes[attr]) {\r\n      } else if (attr !== 'evt-data') {\r\n        oldNode.removeAttribute(attr)\r\n      }\r\n    }\r\n  }\r\n\r\n  function patch (oldNode, newNode) {\r\n    if (oldNode.nodeType === newNode.nodeType) {\r\n      if (oldNode.nodeType === DOCUMENT_ELEMENT_TYPE) {\r\n        arbiter(oldNode, newNode)\r\n        if (isEqual(oldNode, newNode)) return\r\n        diff(oldNode.firstChild, newNode.firstChild)\r\n        if (oldNode.nodeName === newNode.nodeName) {\r\n          setAttr(oldNode, newNode)\r\n        } else {\r\n          oldNode.parentNode.replaceChild(newNode, oldNode)\r\n        }\r\n      } else {\r\n        if (oldNode.nodeValue !== newNode.nodeValue) {\r\n          oldNode.nodeValue = newNode.nodeValue\r\n        }\r\n      }\r\n    } else {\r\n      oldNode.parentNode.replaceChild(newNode, oldNode)\r\n    }\r\n  }\r\n\r\n  function getIndex (store, count) {\r\n    return store.length - count - 1\r\n  }\r\n\r\n  let checkNew\r\n  let checkOld\r\n\r\n  function diff (oldNode, newNode) {\r\n    let count = 0\r\n    let newStore = []\r\n    while (newNode) {\r\n      count++\r\n      checkNew = newNode\r\n      newNode = newNode.nextSibling\r\n      newStore.push(checkNew)\r\n    }\r\n    let index\r\n    let oldParentNode = oldNode && oldNode.parentNode\r\n    while (oldNode) {\r\n      count--\r\n      checkOld = oldNode\r\n      oldNode = oldNode.nextSibling\r\n      index = getIndex(newStore, count)\r\n      if (checkOld && newStore[index]) {\r\n        patch(checkOld, newStore[index])\r\n      } else if (checkOld && !newStore[index]) {\r\n        oldParentNode.removeChild(checkOld)\r\n      }\r\n      if (oldNode === null) {\r\n        while (count > 0) {\r\n          count--\r\n          index = getIndex(newStore, count)\r\n          oldParentNode.appendChild(newStore[index])\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  if (type === 'initial' || type === 'update') {\r\n    check(instance, type)\r\n  } else if (type === 'event') {\r\n    addEvt(instance, type)\r\n  } else if (type === 'diff') {\r\n    let base = getId(ctx.el)\r\n    if (base && !ctx.IS_STUB) {\r\n      diff(base.firstChild, instance)\r\n    } else if (base) {\r\n      diff(base, instance)\r\n    }\r\n  }\r\n}\r\n\r\nexport default templateParse\r\n","import templateParse from './templateParse/index'\r\nimport { setState, addState } from './genElement'\r\nimport { getId, assert } from '../../utils'\r\n\r\nconst DOCUMENT_ELEMENT_TYPE = 1\r\n\r\nexport default function (stub) {\r\n  templateParse(this, addState, null, null, null, 'initial')\r\n  templateParse(this, addState, null, null, null, 'update')\r\n  templateParse(this, addState, null, null, null, 'event')\r\n  const el = stub || getId(this.el)\r\n  if (el) {\r\n    if (el.nodeType === DOCUMENT_ELEMENT_TYPE) {\r\n      el.setAttribute('data-ignore', '')\r\n    } else {\r\n      assert(this.base.childNodes.length === 1, 'Sub-component should only has a single rootNode.')\r\n      !this.base.firstChild.hasAttribute('data-ignore') && this.base.firstChild.setAttribute('data-ignore', '')\r\n    }\r\n    // listen to state changes\r\n    setState.call(this)\r\n    // mount fragment to DOM\r\n    if (!stub) {\r\n      el.appendChild(this.base)\r\n    }\r\n\r\n    // since component already rendered, trigger its life-cycle method\r\n    if (this.componentDidMount && typeof this.componentDidMount === 'function') {\r\n      this.componentDidMount()\r\n    }\r\n  } else {\r\n    assert(false, 'No element with id: \"' + this.el + '\" exist.')\r\n  }\r\n}\r\n","import { clearState } from '../components/genElement'\r\nimport { assert } from '../../utils'\r\n\r\nconst DOCUMENT_FRAGMENT_TYPE = 11\r\nconst DOCUMENT_TEXT_TYPE = 3\r\nconst DOCUMENT_ELEMENT_TYPE = 1\r\n/**\r\n * @private\r\n * @description\r\n * Mount an instance of string or html elements\r\n *\r\n * @param {String|Object} instance - the html/string\r\n */\r\nexport default function (instance) {\r\n  let base\r\n  let tempDiv\r\n  let frag = document.createDocumentFragment()\r\n  // Before we begin to parse an instance, do a run-down checks\r\n  // to clean up back-tick string which usually has line spacing.\r\n  if (typeof instance === 'string') {\r\n    base = instance.trim().replace(/\\s+/g, ' ')\r\n    tempDiv = document.createElement('div')\r\n    tempDiv.innerHTML = base\r\n    while (tempDiv.firstChild) {\r\n      frag.appendChild(tempDiv.firstChild)\r\n    }\r\n  // If instance is a html element process as html entities\r\n  } else if (typeof instance === 'object' && instance['nodeType']) {\r\n    if (instance['nodeType'] === DOCUMENT_ELEMENT_TYPE) {\r\n      frag.appendChild(instance)\r\n    } else if (instance['nodeType'] === DOCUMENT_FRAGMENT_TYPE) {\r\n      frag = instance\r\n    } else if (instance['nodeType'] === DOCUMENT_TEXT_TYPE) {\r\n      frag.appendChild(instance)\r\n    } else {\r\n      assert(false, 'Unable to parse instance, unknown type.')\r\n    }\r\n  } else {\r\n    assert(false, 'Parameter is not a string or a html element.')\r\n  }\r\n  // we store the pristine instance in __pristineFragment__\r\n  this.__pristineFragment__ = frag.cloneNode(true)\r\n  this.base = frag\r\n\r\n  // cleanup states on mount\r\n  clearState()\r\n  return this\r\n}\r\n","export default (str) => {\r\n  let res = str.match(/\\.*\\./g)\r\n  let result\r\n  if (res && res.length > 0) {\r\n    return str.split('.')\r\n  }\r\n  return result\r\n}\r\n","const genId = () => {\r\n  const rd = () => (Math.random() * 1 * 1e17).toString(36)\r\n  return `KDATA-${rd()}-${rd()}`\r\n}\r\n\r\nconst minId = () => (Math.random() * 1 * 1e17).toString(36)\r\n\r\nconst getId = id => document.getElementById(id)\r\n\r\n/**\r\n * @private\r\n * @description\r\n * Check a node availability in 100ms, if not found silenty skip the event\r\n * or execute a callback\r\n *\r\n * @param {string} id - the node id\r\n * @param {function} callback - the function to execute on success\r\n * @param {function} notFound - the function to execute on failed\r\n */\r\nconst checkNodeAvailability = (component, componentName, callback, notFound) => {\r\n  let ele = getId(component.el)\r\n  let found = false\r\n  let t\r\n  function find () {\r\n    ele = getId(component.el)\r\n    if (ele) {\r\n      clearInterval(t)\r\n      found = true\r\n      callback(component, componentName, ele)\r\n    }\r\n  }\r\n  function fail () {\r\n    clearInterval(t)\r\n    if (!found && notFound && typeof notFound === 'function') notFound()\r\n  }\r\n  if (ele) return ele\r\n  else {\r\n    t = setInterval(find, 0)\r\n    // ignore finding the node after sometimes\r\n    setTimeout(fail, 5)\r\n  }\r\n}\r\n\r\n/**\r\n * @private\r\n * @description\r\n * Confirm that a value is truthy, throws an error message otherwise.\r\n *\r\n * @param {*} val - the val to test.\r\n * @param {string} msg - the error message on failure.\r\n * @throws {Error}\r\n */\r\nconst assert = (val, msg) => {\r\n  if (!val) throw new Error('(keet) ' + msg)\r\n}\r\n\r\n/**\r\n * @private\r\n * @description\r\n * Simple html template literals MODIFIED from : http://2ality.com/2015/01/template-strings-html.html\r\n * by Dr. Axel Rauschmayer\r\n * no checking for wrapping in root element\r\n * no strict checking\r\n * remove spacing / indentation\r\n * keep all spacing within html tags\r\n * include handling ${} in the literals\r\n */\r\nconst html = (...args) => {\r\n  const literals = args.shift()\r\n  const substs = args.slice()\r\n\r\n  let result = literals.raw.reduce((acc, lit, i) => acc + substs[i - 1] + lit)\r\n  // remove spacing, indentation from every line\r\n  result = result.split(/\\n+/)\r\n  result = result.map(t => t.trim()).join('')\r\n  return result\r\n}\r\n\r\nconst notEqual = function (a, b) {\r\n  return a['kdata-id'] !== b['kdata-id']\r\n}\r\n\r\nconst inform = function (...args) {\r\n  this.exec && typeof this.exec === 'function' && this.exec.apply(null, args)\r\n}\r\n\r\n/**\r\n * @private\r\n * @description\r\n * Copy with modification from preact-todomvc. Model constructor with\r\n * registering callback listener in Object.defineProperty. Any modification\r\n * to ```this.list``` instance will subsequently inform all registered listener.\r\n *\r\n * {{model:<myModel>}}<myModelTemplateString>{{/model:<myModel>}}\r\n *\r\n */\r\nclass createModel {\r\n  constructor (enableFiltering) {\r\n    // if enableFiltering is assigned a value, model generation will\r\n    // use `listFilter` instead of `list`\r\n    this.enableFiltering = enableFiltering || null\r\n\r\n    this.exec = null\r\n\r\n    this.model = []\r\n\r\n    // Register callback listener of any changes\r\n    Object.defineProperty(this, 'list', {\r\n      enumerable: false,\r\n      configurable: true,\r\n      get: function () {\r\n        return this.model\r\n      },\r\n      set: function (val) {\r\n        this.model = val\r\n        inform.call(this, this.model, this.listFilter)\r\n      }\r\n    })\r\n\r\n    // Register callback listener of any changes with filter\r\n    Object.defineProperty(this, 'listFilter', {\r\n      enumerable: false,\r\n      configurable: true,\r\n      get: function () {\r\n        return !this.prop ? this.model : this.model.filter(obj => obj[this.prop] === this.value)\r\n      }\r\n    })\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   * @description\r\n   * Subscribe to the model changes (add/update/destroy)\r\n   *\r\n   * @param {Object} model - the model including all prototypes\r\n   *\r\n   */\r\n  subscribe (fn) {\r\n    this.exec = fn\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   * @description\r\n   * Add new object to the model list\r\n   *\r\n   * @param {Object} obj - new object to add into the model list\r\n   *\r\n   */\r\n  add (obj) {\r\n    this.list = this.list.concat({ ...obj, 'kdata-id': minId() })\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   * @description\r\n   * Update existing object in the model list\r\n   *\r\n   * @param {String} lookupId - lookup id property name of the object\r\n   * @param {Object} updateObj - the updated properties\r\n   *\r\n   */\r\n  update (updateObj) {\r\n    this.list = this.list.map(obj =>\r\n      notEqual(obj, updateObj) ? obj : updateObj\r\n    )\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   * @description\r\n   * Filter the model data by selected properties, constructor\r\n   * instantiation should be apply with boolean true as argument\r\n   * to enable filtering\r\n   * @param {String} prop - property of the object\r\n   * @param {String|Boolean|Interger} value - property value\r\n   *\r\n   */\r\n  filter (prop, value) {\r\n    this.prop = prop\r\n    this.value = value\r\n    this.list = this.list.map(obj => obj)\r\n  }\r\n\r\n  /**\r\n * @private\r\n * @description\r\n * Removed existing object in the model list\r\n *\r\n * @param {String} lookupId - lookup id property name of the object\r\n * @param {String} objId - unique identifier of the lookup id\r\n *\r\n */\r\n  destroy (destroyObj) {\r\n    this.list = this.list.filter(obj =>\r\n      notEqual(obj, destroyObj)\r\n    )\r\n  }\r\n}\r\n\r\nexport {\r\n  createModel,\r\n  html,\r\n  assert,\r\n  checkNodeAvailability,\r\n  genId,\r\n  getId,\r\n  minId\r\n}\r\n","import ternaryOps from './ternaryOps'\r\n\r\nconst re = new RegExp(/(\\schecked=\")(.*?)(?=\")/g)\r\n\r\nlet tmpl = ''\r\nlet rep\r\nlet isTernary\r\nlet i\r\nlet len\r\nlet match\r\n\r\nexport default (string, obj) => {\r\n  const arrProps = string.match(/{{([^{}]+)}}/g)\r\n  tmpl = string\r\n  for (i = 0, len = arrProps.length; i < len; i++) {\r\n    rep = arrProps[i].replace(/{{([^{}]+)}}/g, '$1')\r\n    isTernary = ternaryOps.call(obj, rep)\r\n    if (isTernary) {\r\n      tmpl = tmpl.replace('{{' + rep + '}}', isTernary.value)\r\n    } else {\r\n      tmpl = tmpl.replace('{{' + rep + '}}', obj[rep])\r\n    }\r\n\r\n    match = tmpl.match(re)\r\n    if (match) {\r\n      if (match[0].length === 17) { tmpl = tmpl.replace(' checked=\"checked\"', ' checked') } else { tmpl = tmpl.replace(' checked=\"\"', '') }\r\n    }\r\n  }\r\n  return tmpl\r\n}\r\n","import templateParse from './templateParse/index'\r\nimport strInterpreter from './strInterpreter'\r\n\r\nconst DELAY = 1\r\n\r\nconst morpher = function () {\r\n  genElement.call(this)\r\n  // exec life-cycle componentDidUpdate\r\n  if (this.componentDidUpdate && typeof this.componentDidUpdate === 'function') {\r\n    this.componentDidUpdate()\r\n  }\r\n}\r\n\r\nlet timer = {}\r\n\r\nconst updateContext = function (fn, delay) {\r\n  timer[this.ID] = timer[this.ID] || null\r\n  clearTimeout(timer[this.ID])\r\n  timer[this.ID] = setTimeout(() => fn.call(this), delay)\r\n}\r\n\r\nconst nextState = function (i) {\r\n  let self = this\r\n  let state\r\n  let value\r\n  if (i < stateList.length) {\r\n    state = stateList[i]\r\n    value = this[state]\r\n\r\n    // if value is undefined, likely has object notation we convert it to array\r\n    if (value === undefined) value = strInterpreter(state)\r\n\r\n    if (value && Array.isArray(value)) {\r\n      // using split object notation as base for state update\r\n      let inVal = this[value[0]][value[1]]\r\n\r\n      Object.defineProperty(this[value[0]], value[1], {\r\n        enumerable: false,\r\n        configurable: true,\r\n        get: function () {\r\n          return inVal\r\n        },\r\n        set: function (val) {\r\n          inVal = val\r\n          updateContext.call(self, morpher, DELAY)\r\n        }\r\n      })\r\n    } else {\r\n      // handle parent state update if the state is not an object\r\n      Object.defineProperty(this, state, {\r\n        enumerable: false,\r\n        configurable: true,\r\n        get: function () {\r\n          return value\r\n        },\r\n        set: function (val) {\r\n          value = val\r\n          updateContext.call(self, morpher, DELAY)\r\n        }\r\n      })\r\n    }\r\n    i++\r\n    nextState.call(this, i)\r\n  }\r\n}\r\n\r\nconst setState = function () {\r\n  nextState.call(this, 0)\r\n}\r\n\r\nlet stateList = []\r\n\r\nconst clearState = () => {\r\n  stateList = []\r\n}\r\n\r\nconst addState = state => {\r\n  if (stateList.indexOf(state) === -1) { stateList = stateList.concat(state) }\r\n}\r\n\r\nconst genElement = function () {\r\n  this.base = this.__pristineFragment__.cloneNode(true)\r\n  templateParse(this, addState, null, null, null, 'initial')\r\n  templateParse(this, addState, null, null, null, 'update')\r\n  templateParse(this, null, null, null, null, 'event')\r\n  templateParse(this, null, null, null, null, 'diff')\r\n}\r\n\r\nexport {\r\n  genElement,\r\n  addState,\r\n  setState,\r\n  clearState,\r\n  updateContext,\r\n  morpher\r\n}\r\n","\r\n/**\r\n * Keetjs v4.0.0 Alpha release: https://github.com/keetjs/keet\r\n * Minimalist view layer for the web\r\n *\r\n * <<<<<<<<<<<<<<<<<<<<<<<<<<<<<< Keetjs >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>\r\n *\r\n * Copyright 2018, Shahrul Nizam Selamat\r\n * Released under the MIT License.\r\n */\r\n\r\nimport parseStr from './src/components/parseStr'\r\nimport { updateContext, morpher } from './src/components/genElement'\r\nimport { genId, assert, html, createModel } from './utils'\r\nimport mount from './src/base/mount'\r\n\r\n// window.l = console.log.bind(console)\r\n// window.tr = console.trace.bind(console)\r\n\r\n/**\r\n * @description\r\n * The main constructor of Keet\r\n *\r\n * Basic Usage :-\r\n *\r\n *    const App extends Keet {}\r\n *    const app = new App()\r\n *    app.mount('hello world').link('app')\r\n *\r\n */\r\nclass Keet {\r\n  constructor () {\r\n    this.ID = Keet.indentity\r\n  }\r\n\r\n  // generate ID for the component\r\n  static get indentity () {\r\n    return genId()\r\n  }\r\n\r\n  mount (instance) {\r\n    return mount.call(this, instance)\r\n  }\r\n\r\n  link (id) {\r\n    // The target DOM where the rendering will took place.\r\n    if (!id) assert(id, 'No id is given as parameter.')\r\n    this.el = id\r\n    this.render()\r\n    return this\r\n  }\r\n\r\n  render (stub) {\r\n    // life-cycle method before rendering the component\r\n    if (this.componentWillMount && typeof this.componentWillMount === 'function') {\r\n      this.componentWillMount()\r\n    }\r\n\r\n    // Render this component to the target DOM\r\n    if (stub) {\r\n      this.IS_STUB = true\r\n    }\r\n    parseStr.call(this, stub)\r\n  }\r\n\r\n  callBatchPoolUpdate () {\r\n    // force component to update, if any state / non-state\r\n    // value changed DOM diffing will occur\r\n    updateContext.call(this, morpher, 1)\r\n  }\r\n\r\n  subscribe (fn) {\r\n    this.exec = fn\r\n  }\r\n\r\n  inform (model) {\r\n    this.exec && typeof this.exec === 'function' && this.exec(model)\r\n  }\r\n}\r\n\r\nexport default Keet\r\n\r\n// export {\r\n//   Keet as default,\r\n//   html,\r\n//   createModel\r\n// }\r\n"]}